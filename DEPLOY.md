# Инструкции по деплою на Render

## Подготовка к деплою

### 1. Создание аккаунта на Render
1. Перейдите на https://render.com
2. Зарегистрируйтесь или войдите в аккаунт
3. Подключите ваш GitHub репозиторий

### 2. Настройка проекта

#### Вариант A: Автоматический деплой через render.yaml
1. Убедитесь, что файл `render.yaml` находится в корне проекта
2. В Render Dashboard выберите "New" → "Blueprint"
3. Подключите ваш GitHub репозиторий
4. Render автоматически обнаружит `render.yaml` и создаст все сервисы

#### Вариант B: Ручной деплой
1. Создайте PostgreSQL базу данных:
   - "New" → "PostgreSQL"
   - Выберите план "Free"
   - Назовите базу данных (например, `vp-ceiling-db`)

2. Создайте Web Service:
   - "New" → "Web Service"
   - Подключите GitHub репозиторий
   - Настройки:
     - **Name**: `vp-ceiling-web`
     - **Environment**: `Python 3`
     - **Build Command**: `pip install -r backend/requirements.txt`
     - **Start Command**: `gunicorn backend.app:app`
     - **Plan**: Free

3. Настройте переменные окружения:
   - **SECRET_KEY**: Сгенерируйте случайную строку
   - **JWT_SECRET_KEY**: Сгенерируйте случайную строку
   - **DATABASE_URL**: Скопируйте из настроек PostgreSQL базы данных

### 3. Настройка переменных окружения

В Render Dashboard для вашего Web Service добавьте следующие переменные:

```
SECRET_KEY=<случайная строка>
JWT_SECRET_KEY=<случайная строка>
DATABASE_URL=<URL из PostgreSQL базы данных>
```

### 4. Первоначальная настройка базы данных

После успешного деплоя:

1. Откройте ваш сайт (URL будет предоставлен Render)
2. Перейдите на `/api/init-db` (POST запрос)
3. Это создаст все необходимые таблицы и администратора

Администратор по умолчанию:
- Email: `admin@test.com`
- Пароль: `admin123`

### 5. Проверка работы

1. Откройте главную страницу сайта
2. Проверьте API: `https://your-app.onrender.com/api/health`
3. Попробуйте зарегистрироваться и войти в систему

## Структура файлов для деплоя

```
project/
├── Procfile                    # Команда запуска для Render
├── render.yaml                 # Конфигурация автоматического деплоя
├── backend/
│   ├── app.py                  # Основное приложение Flask
│   ├── requirements.txt        # Python зависимости
│   └── ...
├── frontend/
│   └── ...
└── README.md
```

## Возможные проблемы и решения

### Проблема: Ошибка подключения к базе данных
**Решение**: Проверьте переменную `DATABASE_URL` и убедитесь, что PostgreSQL база данных запущена

### Проблема: Ошибка импорта модулей
**Решение**: Убедитесь, что все зависимости указаны в `requirements.txt`

### Проблема: Статические файлы не загружаются
**Решение**: Проверьте настройки CORS и пути к статическим файлам

### Проблема: Загрузка файлов не работает
**Решение**: На Render файлы сохраняются во временную файловую систему. Для продакшена рекомендуется использовать внешнее хранилище (AWS S3, Cloudinary)

## Обновление приложения

1. Внесите изменения в код
2. Зафиксируйте изменения в Git
3. Запушьте в GitHub
4. Render автоматически пересоберет и перезапустит приложение

## Мониторинг

- Логи доступны в Render Dashboard
- Используйте `/api/health` для проверки состояния приложения
- Мониторьте использование ресурсов в Dashboard

## Безопасность

- Никогда не коммитьте `.env` файлы
- Используйте сильные пароли для переменных окружения
- Регулярно обновляйте зависимости
- Настройте HTTPS (автоматически предоставляется Render)
